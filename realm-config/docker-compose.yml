version: '3.8'
services:
  keycloak:
    image: quay.io/keycloak/keycloak:24.0.2
    container_name: keycloak
    environment:
      - KEYCLOAK_ADMIN=admin
      - KEYCLOAK_ADMIN_PASSWORD=admin1234
      - HTTP_PORT=${PORT}  # Railway assigns dynamic port
    command: ["/opt/keycloak/bin/kc.sh", "start-dev", "--import-realm", "--http-port=${PORT}"]
    healthcheck:
      test: ["CMD", "curl", "--silent", "--fail", "http://localhost:${PORT}/health/ready"]
      interval: 30s
      retries: 3
      start_period: 30s
      timeout: 10s
